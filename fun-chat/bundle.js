(()=>{"use strict";var e={56:(e,n,t)=>{e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72:e=>{var n=[];function t(e){for(var t=-1,o=0;o<n.length;o++)if(n[o].identifier===e){t=o;break}return t}function o(e,o){for(var a={},i=[],r=0;r<e.length;r++){var d=e[r],l=o.base?d[0]+o.base:d[0],c=a[l]||0,u="".concat(l," ").concat(c);a[l]=c+1;var p=t(u),g={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==p)n[p].references++,n[p].updater(g);else{var h=s(g,o);o.byIndex=r,n.splice(r,0,{identifier:u,updater:h,references:1})}i.push(u)}return i}function s(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,s){var a=o(e=e||[],s=s||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var r=t(a[i]);n[r].references--}for(var d=o(e,s),l=0;l<a.length;l++){var c=t(a[l]);0===n[c].references&&(n[c].updater(),n.splice(c,1))}a=d}}},113:e=>{e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},208:(e,n,t)=>{t.d(n,{A:()=>r});var o=t(601),s=t.n(o),a=t(314),i=t.n(a)()(s());i.push([e.id,"html {\n  box-sizing: border-box;\n}\n\nbody {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  width: 100%;\n  height: 100vh;\n  margin: 0;\n\n  background-color: #f0f0f0;\n}\n",""]);const r=i},306:(e,n,t)=>{t.d(n,{A:()=>r});var o=t(601),s=t.n(o),a=t(314),i=t.n(a)()(s());i.push([e.id,".main {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n  justify-content: center;\n\n  box-sizing: border-box;\n  width: 95vw;\n  max-width: 1000px;\n  height: 90vh;\n  padding: 20px;\n  border-radius: 8px;\n\n  background-color: #fff;\n  box-shadow: 0 4px 6px rgb(0 0 0 / 10%);\n}\n\n.header-section,\n.footer-section {\n  display: flex;\n  align-items: center;\n  justify-content: space-around;\n\n  padding: 0 10px;\n  border: 1px solid #ddd;\n  border-radius: 8px;\n\n  background-color: #f9f9f9;\n}\n\n.header-content {\n  display: flex;\n  gap: 20px;\n  width: 80%;\n}\n\na label {\n  cursor: pointer;\n}\n\n.header-content label {\n  width: 50%;\n}\n\n.input {\n  box-sizing: border-box;\n  width: 100%;\n  padding: 10px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n\n  font-size: 1rem;\n\n  outline: none;\n}\n\n.input:focus {\n  border-color: #007bff;\n}\n\nbutton {\n  cursor: pointer;\n\n  margin: 10px;\n  padding: 8px 16px;\n  border: none;\n  border-radius: 4px;\n\n  font-size: 1rem;\n  color: #fff;\n\n  background-color: #007bff;\n  box-shadow: 0 0 4px 4px #d2d6df;\n\n  transition: background-color 0.3s ease;\n}\n\nbutton:hover {\n  box-shadow: none;\n}\n\nbutton[disabled] {\n  pointer-events: none;\n  opacity: 0.5;\n}\n\n.user-section {\n  display: flex;\n  flex: 1;\n  gap: 20px;\n\n  box-sizing: border-box;\n  width: 100%;\n  max-height: 75%;\n}\n\n.user-container {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n\n  width: 30%;\n  padding: 10px;\n  border: 1px solid #ddd;\n  border-radius: 8px;\n\n  background-color: #f9f9f9;\n}\n\n.list {\n  overflow-y: auto;\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  justify-content: flex-start;\n\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n\n  background-color: #fff;\n}\n\n.list-item {\n  display: flex;\n  gap: 5px;\n  align-items: center;\n  justify-content: flex-start;\n\n  padding: 10px;\n}\n\n.user-status-online {\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: green;\n}\n\n.user-status-offline {\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: gray;\n}\n\n.dialog-container {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n\n  width: 70%;\n  padding: 10px;\n  border: 1px solid #ddd;\n  border-radius: 8px;\n\n  background-color: #f9f9f9;\n}\n\n.header-message-content {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n\n  padding: 10px;\n  border-bottom: 1px solid #ddd;\n}\n\n.header-message-content label,\n.header-content label,\n.user-name {\n  width: 100%;\n  font-size: 1rem;\n  font-weight: bold;\n  color: #333;\n}\n\n.message-content {\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n\n  box-sizing: border-box;\n  height: 100%;\n  max-height: 70%;\n  padding: 10px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n\n  background-color: #fff;\n}\n\n.message-content label {\n  text-align: center;\n}\n\n.message-container {\n  display: flex;\n}\n\n.message-data {\n  display: flex;\n  flex-direction: column;\n\n  width: 70%;\n  padding: 10px 10px 0;\n  border: 1px solid #ddd;\n  border-radius: 8px;\n\n  background-color: #f9f9f9;\n}\n\n.message-text {\n  box-sizing: border-box;\n  padding: 10px;\n  border-radius: 4px;\n\n  overflow-wrap: break-word;\n\n  background-color: #fff;\n}\n\n.message-header {\n  display: flex;\n  justify-content: space-between;\n  width: 100%;\n}\n\n.message-footer {\n  display: flex;\n  justify-content: space-between;\n  width: 100%;\n}\n\n.message-header label {\n  font-size: 0.8rem;\n}\n\n.message-unread {\n  height: 1.2em;\n  font-size: 1.1rem;\n  color: #b3afaf;\n}\n\n.message-read {\n  color: green;\n}\n\n.form-message {\n  display: flex;\n  box-sizing: border-box;\n}\n\n.textarea {\n  resize: none;\n\n  flex-grow: 1;\n\n  padding: 8px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n\n  font-size: 1rem;\n}\n\n.footer-content {\n  display: flex;\n  justify-content: space-around;\n}\n\n.rss-link {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  align-items: center;\n\n  font-size: 1rem;\n  color: #333;\n  text-align: center;\n}\n\n.image {\n  width: 30px;\n  height: 30px;\n}\n\na {\n  margin: 15px 0;\n  color: #333;\n  text-decoration: none;\n}\n\n.separator-line {\n  padding: 5px 0;\n  border-bottom: 1px solid #ccc;\n\n  font-weight: bold;\n  text-align: center;\n\n  background-color: #f0f0f0;\n}\n\n.context-menu {\n  position: absolute;\n  z-index: 1000;\n\n  min-width: 120px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n\n  background-color: #fff;\n  box-shadow: 0 2px 5px rgb(0 0 0 / 20%);\n}\n\n.context-menu div {\n  cursor: pointer;\n  padding: 8px 12px;\n  transition: background-color 0.2s ease;\n}\n\n.context-menu div:hover {\n  background-color: #f0f0f0;\n}\n\n@media screen and (width <=560px) {\n  .main {\n    width: 90vw;\n    padding: 10px;\n  }\n\n  .header-content {\n    flex-direction: column;\n  }\n\n  .user-section {\n    gap: 10px;\n  }\n\n  .dialog-container {\n    width: 60%;\n  }\n\n  label,\n  button,\n  .header-message-content label,\n  .header-content label,\n  .user-name,\n  .input,\n  .textarea {\n    font-size: 0.8rem;\n  }\n}\n",""]);const r=i},314:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map((function(n){var t="",o=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),o&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),o&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t})).join("")},n.i=function(e,t,o,s,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var r=0;r<this.length;r++){var d=this[r][0];null!=d&&(i[d]=!0)}for(var l=0;l<e.length;l++){var c=[].concat(e[l]);o&&i[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),s&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=s):c[4]="".concat(s)),n.push(c))}},n}},378:(e,n,t)=>{t.d(n,{A:()=>r});var o=t(601),s=t.n(o),a=t(314),i=t.n(a)()(s());i.push([e.id,".about {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  align-items: center;\n  justify-content: center;\n\n  box-sizing: border-box;\n  width: 95vw;\n  max-width: 770px;\n  height: 90vh;\n  max-height: 300px;\n  padding: 20px;\n  border-radius: 8px;\n\n  text-align: center;\n\n  background-color: #fff;\n  box-shadow: 0 4px 6px rgb(0 0 0 / 10%);\n}\n\nh3 {\n  margin: 12px;\n  font-size: 1.3rem;\n  font-weight: bold;\n}\n\nlabel {\n  font-size: 1rem;\n  color: #333;\n}\n",""]);const r=i},465:(e,n,t)=>{t.d(n,{A:()=>r});var o=t(601),s=t.n(o),a=t(314),i=t.n(a)()(s());i.push([e.id,".form-authentication {\n  box-sizing: border-box;\n  padding: 20px;\n  border-radius: 8px;\n\n  background-color: #fff;\n  box-shadow: 0 4px 6px rgb(0 0 0 / 10%);\n}\n\n.fieldset {\n  border: none;\n}\n\n.fieldset legend {\n  margin-bottom: 20px;\n  font-size: 1.5rem;\n  font-weight: bold;\n  text-align: center;\n}\n\n.container-filed {\n  margin-bottom: 15px;\n}\n\n.input {\n  box-sizing: border-box;\n  width: 100%;\n  padding: 10px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n\n  font-size: 1rem;\n\n  outline: none;\n}\n\n.input:focus {\n  border-color: #007bff;\n}\n\n.container-buttons {\n  display: flex;\n  justify-content: space-around;\n}\n\nbutton {\n  cursor: pointer;\n\n  padding: 8px 16px;\n  border: none;\n  border-radius: 4px;\n\n  font-size: 1rem;\n  color: #fff;\n\n  background-color: #007bff;\n  box-shadow: 0 0 4px 4px #d2d6df;\n\n  transition: background-color 0.3s ease;\n}\n\nbutton:hover {\n  box-shadow: none;\n}\n\nbutton[disabled] {\n  pointer-events: none;\n  opacity: 0.5;\n}\n\n.error-message {\n  display: none;\n  margin-top: 5px;\n  font-size: 0.9rem;\n  color: red;\n}\n",""]);const r=i},540:e=>{e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var n={};e.exports=function(e,t){var o=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var s=void 0!==t.layer;s&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,s&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),n.styleTagTransform(o,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}},927:(e,n,t)=>{t.d(n,{A:()=>r});var o=t(601),s=t.n(o),a=t(314),i=t.n(a)()(s());i.push([e.id,".dialog {\n  max-width: 90%;\n  padding: 20px;\n  border: 1px solid #ccc;\n  border-radius: 8px;\n\n  background-color: #fff;\n}\n\n.dialog::backdrop {\n  background-color: rgb(0 0 0 / 50%);\n}\n\n.content {\n  display: flex;\n  flex-direction: column;\n  gap: 15px;\n  align-items: center;\n\n  text-align: center;\n}\n\n.message {\n  margin: 0;\n  font-size: 1rem;\n  color: #333;\n}\n",""]);const r=i}},n={};function t(o){var s=n[o];if(void 0!==s)return s.exports;var a=n[o]={id:o,exports:{}};return e[o](a,a.exports,t),a.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.nc=void 0;const o="Info",s="JollyTalk",a="Natallia Katsuba",i="https://github.com/nata1ka89",r="RSSchool",d="Select a user to send a message to...",l="Write your first message...",c="/login",u="/about",p="/main",g="Element is null",h=[];class f{constructor(e,n="div",t="",o=""){this.buttons=[];const s=document.createElement(n);s.className=t,s.textContent=o,this.node=s;try{(function(e){if(null===e)throw new Error(g);return e})(e).append(this.node)}catch(e){console.error(g,e)}h.push(this)}setAttribute(e,n){this.node.setAttribute(e,n)}removeAttribute(e){this.node.removeAttribute(e)}setCallback(e,n){this.node.addEventListener(e,n)}destroy(){this.node.remove()}}class m extends f{constructor(e,n){super(e,"dialog","dialog"),this.createModal(n)}closeModal(){this.node instanceof HTMLDialogElement&&(this.node.close(),this.node.remove())}createModal(e){const n=new f(this.node,"div","content");new f(n.node,"p","message",`${e}`),this.viewModal()}viewModal(){this.node instanceof HTMLDialogElement&&this.node.showModal()}}var b=t(72),y=t.n(b),x=t(825),v=t.n(x),w=t(659),S=t.n(w),E=t(56),A=t.n(E),I=t(540),L=t.n(I),U=t(113),T=t.n(U),M=t(927),k={};k.styleTagTransform=T(),k.setAttributes=A(),k.insert=S().bind(null,"head"),k.domAPI=v(),k.insertStyleElement=L(),y()(M.A,k),M.A&&M.A.locals&&M.A.locals;class D extends f{constructor(e,n){super(e,"dialog","dialog"),this.createModal(n)}closeModal(){this.node instanceof HTMLDialogElement&&(this.node.close(),this.node.remove())}createModal(e){const n=new f(this.node,"div","content");new f(n.node,"p","message",`${e}`);const t=new f(n.node,"button","button close-button","Close");t.setAttribute("type","button"),t.setCallback("click",(()=>this.closeModal())),this.viewModal()}viewModal(){if(this.node instanceof HTMLDialogElement){const e=this.node;e.showModal(),e.addEventListener("cancel",(()=>{this.closeModal()})),e.addEventListener("click",(n=>{n.target===e&&this.closeModal()}))}}}var R,C=t(306),_={};function j(){return{id:sessionStorage.getItem("currentUserId"),login:sessionStorage.getItem("currentUserLogin"),password:sessionStorage.getItem("currentUserPassword"),userTo:sessionStorage.getItem("currentUserTo"),userToStatus:sessionStorage.getItem("currentUserToStatus")}}function N(){sessionStorage.removeItem("currentUserId"),sessionStorage.removeItem("currentUserLogin"),sessionStorage.removeItem("currentUserPassword"),sessionStorage.removeItem("currentUserTo"),sessionStorage.removeItem("currentUserToStatus")}function G(){ae({id:crypto.randomUUID(),type:R.USER_ACTIVE,payload:null})}function O(){ae({id:crypto.randomUUID(),type:R.USER_INACTIVE,payload:null})}function z(e){ae({id:crypto.randomUUID(),type:R.MSG_FROM_USER,payload:{user:{login:e}}})}function P(e){for(const n of e)ae({id:crypto.randomUUID(),type:R.MSG_READ,payload:{message:{id:n}}})}_.styleTagTransform=T(),_.setAttributes=A(),_.insert=S().bind(null,"head"),_.domAPI=v(),_.insertStyleElement=L(),y()(C.A,_),C.A&&C.A.locals&&C.A.locals,function(e){e.USER_LOGIN="USER_LOGIN",e.USER_LOGOUT="USER_LOGOUT",e.ERROR="ERROR",e.USER_EXTERNAL_LOGIN="USER_EXTERNAL_LOGIN",e.USER_EXTERNAL_LOGOUT="USER_EXTERNAL_LOGOUT",e.USER_ACTIVE="USER_ACTIVE",e.USER_INACTIVE="USER_INACTIVE",e.MSG_SEND="MSG_SEND",e.MSG_FROM_USER="MSG_FROM_USER",e.MSG_DELIVER="MSG_DELIVER",e.MSG_READ="MSG_READ",e.MSG_DELETE="MSG_DELETE",e.MSG_EDIT="MSG_EDIT"}(R||(R={}));class F extends f{constructor(e,n){super(e,"section","header-section"),this.router=n,this.createHeader()}createHeader(){const e=sessionStorage.getItem("currentUserLogin");if(e){const n=new f(this.node,"div","header-content");new f(n.node,"label","",`User: ${e}`),new f(n.node,"label","",s),new f(this.node,"button","exit-button","Exit").setCallback("click",(()=>{!function(){const{id:e,login:n,password:t}=j();e&&n&&t&&(ae({id:e,type:R.USER_LOGOUT,payload:{user:{login:n,password:t}}}),N())}()}))}new f(this.node,"button","info-button",o).setCallback("click",(()=>this.router.navigate(u)))}}const H=[];class $ extends f{constructor(e){super(e,"div","user-container"),this.createUserList([])}updateUserList(e){for(const n of e){const e=H.findIndex((e=>n.login===e.login));-1===e?H.push(n):H[e].isLogined=n.isLogined}const n=sessionStorage.getItem("currentUserLogin"),t=H.filter((e=>e.login!==n));this.createUserList(t)}createUserList(e){this.node&&(this.node.textContent="");const n=new f(this.node,"input","input");n.setAttribute("type","text"),n.setAttribute("placeholder","search..."),n.setCallback("input",(n=>{if(n.target instanceof HTMLInputElement){const t=n.target.value.toLowerCase(),o=e.filter((e=>e.login.toLowerCase().includes(t)));this.renderFilterUserList(o)}})),this.list=new f(this.node,"ul","list"),this.renderFilterUserList(e)}renderFilterUserList(e){if(this.list&&J){this.list.node.textContent="";for(const n of e){const e=n.isLogined?"user-status-online":"user-status-offline",t=new f(this.list.node,"li","list-item");new f(t.node,"div",e),new f(t.node,"label","user-name",n.login).setCallback("click",(e=>{if(e.target instanceof HTMLLabelElement&&J&&J.sendButton&&J.textArea&&J.messageDiv){J.messageDiv.node.textContent="",J.sendButton.removeAttribute("disabled"),J.textArea.removeAttribute("disabled");const t=e.target.textContent;t&&sessionStorage.setItem("currentUserTo",t);const o=n.isLogined;sessionStorage.setItem("currentUserToStatus",`${o}`),J.renderHeaderDialogContainer(t,o),t&&(this.labelPlaceholderNew=new f(J.messageDiv.node,"label","",l),z(t))}}))}}}}class B extends f{constructor(e){super(e,"section","footer-section"),this.createFooter()}createFooter(){new f(this.node,"label","","2025");const e=new f(this.node,"a","rss-link");e.setAttribute("href","https://rs.school/courses/javascript-ru"),e.setAttribute("target","_blank");const n=new f(e.node,"img","image");n.setAttribute("src","https://rs.school/_next/static/media/rss-logo.c19ce1b4.svg"),n.setAttribute("alt",r),new f(e.node,"label","",r);const t=new f(this.node,"a","",a);t.setAttribute("href",i),t.setAttribute("target","_blank")}}class V extends f{constructor(e){super(e,"div","dialog-container"),this.isEditing=!1,this.editingMessageId="",this.createDialogContainer()}createSendMessage(e,n,t,o,s,a){if(this.messageDiv){const i=o?"✔✔":"✔",r=a?"edited":"",d=new f(this.messageDiv.node,"div","message-container");d.node.style.justifyContent="flex-end";const l=new f(d.node,"div","message-data"),c=new f(l.node,"div","message-header");new f(c.node,"label","","you"),new f(c.node,"label","",n),new f(l.node,"div","message-text",t);const u=new f(l.node,"div","message-footer");new f(u.node,"label","",r),this.readMessage=new f(u.node,"label","message-unread",i),s&&this.readMessage.node.classList.add("message-read"),this.messageDiv.node.scrollTop=this.messageDiv.node.scrollHeight,d.setCallback("contextmenu",(n=>{n.preventDefault(),this.showContextMenu(n,e,t)}))}}createReceiveMessage(e,n,t,o){const s=sessionStorage.getItem("currentUserTo");if(this.messageDiv&&t===s){const s=new f(this.messageDiv.node,"div","message-container");s.node.style.justifyContent="",s.setAttribute("id",o);const a=new f(s.node,"div","message-data"),i=new f(a.node,"div","message-header");new f(i.node,"label","",t),new f(i.node,"label","",e),new f(a.node,"div","message-text",n);const r=new f(a.node,"div","message-footer");new f(r.node,"label","message-unread",""),this.messageDiv.node.scrollTop=this.messageDiv.node.scrollHeight}}renderHeaderDialogContainer(e,n){if(this.headerMessageDiv&&this.messageDiv)if(this.headerMessageDiv.node.textContent="",e){const t=n?"online":"offline";this.headerLogin=new f(this.headerMessageDiv.node,"label","",e),new f(this.headerMessageDiv.node,"label","",t)}else this.messageDiv.node.textContent="",this.labelPlaceholder=new f(this.messageDiv.node,"label","",d)}updateStatusMessage(e){const n=e.map((e=>e.id));if(this.messageDiv){const e=this.messageDiv,t=()=>{var o;P(n),null===(o=this.separatorLine)||void 0===o||o.destroy(),this.separatorLine=void 0,e.node.scrollTop=e.node.scrollHeight,e.node.removeEventListener("click",t),this.allMessagesRead=!0};e.setCallback("click",t)}}addSeparatorLine(e,n,t){if(this.messageDiv&&!this.separatorLine&&n!==t){this.separatorLine=new f(this.messageDiv.node,"div","separator-line","New Messages");const n=[...this.messageDiv.node.children].find((n=>n.id===e.id));n&&this.messageDiv.node.insertBefore(this.separatorLine.node,n)}}createDialogContainer(){let e;this.headerMessageDiv=new f(this.node,"div","header-message-content"),this.messageDiv=new f(this.node,"div","message-content"),this.labelPlaceholder=new f(this.messageDiv.node,"label","",d);const n=new f(this.node,"form","form-message");this.textArea=new f(n.node,"textarea","textarea"),this.textArea.setAttribute("placeholder","message..."),this.textArea.setAttribute("disabled","true"),this.textArea.setCallback("input",(n=>{n.target instanceof HTMLTextAreaElement&&(e=n.target.value)})),this.textArea.setCallback("keydown",(n=>{"Enter"===n.key&&(n.preventDefault(),e=this.clearField(e))})),this.sendButton=new f(n.node,"button","log-button","Send"),this.sendButton.setAttribute("disabled","true"),this.sendButton.setCallback("click",(n=>{n.preventDefault(),e=this.clearField(e)}))}showContextMenu(e,n,t){this.messageDiv&&(this.menu&&this.menu.destroy(),this.menu=new f(this.messageDiv.node,"div","context-menu"),this.menu.node.style.top=`${e.clientY}px`,this.menu.node.style.left=`${e.clientX}px`,new f(this.menu.node,"div","","edit").setCallback("click",(()=>{this.textArea&&this.textArea.node instanceof HTMLTextAreaElement&&(this.textArea.node.value=t,this.isEditing=!0,this.editingMessageId=n,this.textArea.node.focus())})),new f(this.menu.node,"div","","delete").setCallback("click",(()=>{return e=n,void ae({id:crypto.randomUUID(),type:R.MSG_DELETE,payload:{message:{id:e}}});var e})),document.addEventListener("click",(()=>{this.menu&&this.menu.destroy()})))}clearField(e){var n,t;const o=sessionStorage.getItem("currentUserTo");var s,a;return o&&e&&this.textArea&&this.textArea.node instanceof HTMLTextAreaElement&&(this.textArea.node.value="",this.isEditing&&this.editingMessageId?(s=this.editingMessageId,a=e,ae({id:crypto.randomUUID(),type:R.MSG_EDIT,payload:{message:{id:s,text:a}}}),this.isEditing=!1,this.editingMessageId=""):function(e,n){ae({id:crypto.randomUUID(),type:R.MSG_SEND,payload:{message:{to:e,text:n}}})}(o,e),e=""),X&&(null===(n=this.labelPlaceholder)||void 0===n||n.destroy(),null===(t=X.labelPlaceholderNew)||void 0===t||t.destroy()),e}}let X,J;class q extends f{constructor(e,n){super(e,"main","main"),this.router=n,new F(this.node,this.router),this.createUserContainer(),new B(this.node),G(),O()}createUserContainer(){const e=new f(this.node,"section","user-section");X=new $(e.node),J=new V(e.node)}}class W{constructor(e){this.routes=[],this.logs=[],this.rootElement=e,globalThis.addEventListener("hashchange",(()=>{this.handleRouteChange()})),this.handleRouteChange()}addRoute(e,n){this.routes.push({path:e,viewComponent:n})}navigate(e){this.logs.push(`Navigated to ${e}`),globalThis.location.hash=`#${e}`}handleRouteChange(){let e=globalThis.location.hash.slice(1);if(!e)return e=c,void this.navigate(e);const n=sessionStorage.getItem("currentUserIsLogined");if(n){if(e===c&&"true"===n)return void this.navigate(p);if(e===p&&"false"===n)return void this.navigate(c)}const t=this.routes.find((n=>n.path===e));t&&(this.rootElement.textContent="",t.viewComponent())}}function Y(e){const n=new Date(e);return`${String(n.getDate()).padStart(2,"0")}.${String(n.getMonth()+1).padStart(2,"0")}.${n.getFullYear()}, ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`}const K=new W(document.body);let Q,Z;function ee(){Q=new WebSocket("ws://localhost:4000"),Q.addEventListener("open",ne),Q.addEventListener("close",te),Q.addEventListener("error",oe),Q.addEventListener("message",se)}function ne(){Z&&(Z.closeModal(),Z=void 0),function(){const{id:e,login:n,password:t}=j();e&&n&&t&&ae({id:e,type:R.USER_LOGIN,payload:{user:{login:n,password:t}}})}(),G(),O(),O()}function te(e){1e3!=e.code&&(Z||(Z=new m(document.body,"Connection to server")),setTimeout((()=>{ee()}),3e3),navigator.onLine||console.log("You are offline. Please connect to the Internet and try again."))}function oe(){console.log("Error")}function se(e){try{if("string"==typeof e.data){const t=JSON.parse(e.data);if("object"==typeof(n=t)&&null!==n&&"type"in n&&"payload"in n&&"object"==typeof n.payload&&null!==n.payload&&"error"in n.payload){const e=t.payload.error;if("a user with this login is already authorized"!==e&&"another user is already authorized in this connection"!==e&&"incorrect password"!==e)return;!function(e){const n=e.payload.error;new D(document.body,n),K.navigate(c),N()}(t)}if(function(e){return"object"==typeof e&&null!==e&&"type"in e&&"payload"in e&&"object"==typeof e.payload&&null!==e.payload&&"user"in e.payload&&"object"==typeof e.payload.user&&null!==e.payload.user&&"login"in e.payload.user&&"isLogined"in e.payload.user}(t)){const e=t.payload.user.login,n=sessionStorage.getItem("currentUserTo");t.type===R.USER_EXTERNAL_LOGIN?(G(),e===n&&(sessionStorage.setItem("currentUserToStatus","true"),z(e))):t.type===R.USER_EXTERNAL_LOGOUT?(O(),e===n&&(sessionStorage.setItem("currentUserToStatus","false"),z(e))):function(e){const n=e.payload.user.isLogined;sessionStorage.setItem("currentUserIsLogined",`${n}`),n?K.navigate(p):K.navigate(c)}(t)}(function(e){return"object"==typeof e&&null!==e&&"type"in e&&"payload"in e&&"object"==typeof e.payload&&null!==e.payload&&"users"in e.payload&&"object"==typeof e.payload.users&&null!==e.payload.users})(t)&&(t.type===R.USER_ACTIVE?function(e){const n=e.payload.users;X&&X.updateUserList(n)}(t):function(e){const n=e.payload.users;X&&X.updateUserList(n)}(t)),function(e){return"object"==typeof e&&null!==e&&"id"in e&&"type"in e&&"payload"in e&&"object"==typeof e.payload&&null!==e.payload&&"message"in e.payload&&"object"==typeof e.payload.message&&null!==e.payload.message&&"id"in e.payload.message&&"from"in e.payload.message&&"to"in e.payload.message&&"text"in e.payload.message&&"datetime"in e.payload.message&&"status"in e.payload.message&&"object"==typeof e.payload.message.status&&null!==e.payload.message.status&&"isDelivered"in e.payload.message.status&&"isReaded"in e.payload.message.status&&"isEdited"in e.payload.message.status}(t)&&function(e){const n=e.payload.message,t=Y(n.datetime),o=sessionStorage.getItem("currentUserLogin");J&&J.headerLogin&&(J.allMessagesRead&&P([n.id]),n.from===o&&J?J.createSendMessage(n.id,t,n.text,n.status.isDelivered,n.status.isReaded,n.status.isEdited):n.to===o&&J&&J.createReceiveMessage(t,n.text,n.from,n.id))}(t),function(e){return"object"==typeof e&&null!==e&&"type"in e&&"payload"in e&&"object"==typeof e.payload&&null!==e.payload&&"messages"in e.payload&&"object"==typeof e.payload.messages&&null!==e.payload.messages}(t)&&function(e){const n=e.payload.messages;if(J&&J.headerLogin){if(J.messageDiv&&X)if(J.messageDiv.node.textContent="",0===n.length)X.labelPlaceholderNew=new f(J.messageDiv.node,"label","",l);else{const e=n.filter((e=>e.status.isReaded)),o=n.filter((e=>!e.status.isReaded));if(t(e),o.length>0){const e=o[0],n=sessionStorage.getItem("currentUserTo");n&&J.addSeparatorLine(e,e.to,n)}t(o),J.updateStatusMessage(o)}const e=sessionStorage.getItem("currentUserTo"),o="true"==sessionStorage.getItem("currentUserToStatus");J.renderHeaderDialogContainer(e,o)}function t(e){for(const n of e){const e=Y(n.datetime),t=n.status.isDelivered,o=sessionStorage.getItem("currentUserLogin"),s=n.status.isReaded,a=n.status.isEdited;n.from===o&&J?J.createSendMessage(n.id,e,n.text,t,s,a):n.to===o&&J&&J.createReceiveMessage(e,n.text,n.from,n.id)}}}(t),function(e){return"object"==typeof e&&null!==e&&"id"in e&&"type"in e&&"payload"in e&&"object"==typeof e.payload&&null!==e.payload&&"message"in e.payload&&"object"==typeof e.payload.message&&null!==e.payload.message&&"id"in e.payload.message&&"status"in e.payload.message&&"object"==typeof e.payload.message.status&&null!==e.payload.message.status&&"isReaded"in e.payload.message.status}(t)&&function(){const e=sessionStorage.getItem("currentUserTo");e&&" "!==e&&z(e)}(),function(e){return"object"==typeof e&&null!==e&&"id"in e&&"type"in e&&"payload"in e&&"object"==typeof e.payload&&null!==e.payload&&"message"in e.payload&&"object"==typeof e.payload.message&&null!==e.payload.message&&"id"in e.payload.message&&"status"in e.payload.message&&"object"==typeof e.payload.message.status&&null!==e.payload.message.status&&"isDeleted"in e.payload.message.status}(t)&&function(){const e=sessionStorage.getItem("currentUserTo");e&&" "!==e&&z(e)}(),function(e){return"object"==typeof e&&null!==e&&"id"in e&&"type"in e&&"payload"in e&&"object"==typeof e.payload&&null!==e.payload&&"message"in e.payload&&"object"==typeof e.payload.message&&null!==e.payload.message&&"id"in e.payload.message&&"text"in e.payload.message&&"status"in e.payload.message&&"object"==typeof e.payload.message.status&&null!==e.payload.message.status&&"isEdited"in e.payload.message.status}(t)&&function(){const e=sessionStorage.getItem("currentUserTo");e&&" "!==e&&z(e)}()}}catch(e){console.error("Error:",e)}var n}function ae(e){Q.readyState===WebSocket.OPEN&&Q.send(JSON.stringify(e))}var ie=t(378),re={};re.styleTagTransform=T(),re.setAttributes=A(),re.insert=S().bind(null,"head"),re.domAPI=v(),re.insertStyleElement=L(),y()(ie.A,re),ie.A&&ie.A.locals&&ie.A.locals;class de extends f{constructor(e){super(e,"main","about"),this.createAbout()}createAbout(){new f(this.node,"h3","",s),new f(this.node,"label","","JollyTalk is an application designed to showcase the Fun Chat task as part of the RSSchool JS/FE 2023Q3 course."),new f(this.node,"label","","Good luck to all students taking the course—keep learning, stay curious, and have fun coding!");const e=new f(this.node,"a","",a);e.setAttribute("href",i),e.setAttribute("target","_blank"),new f(this.node,"button","back-button","Back").setCallback("click",(()=>globalThis.history.back()))}}var le=t(465),ce={};ce.styleTagTransform=T(),ce.setAttributes=A(),ce.insert=S().bind(null,"head"),ce.domAPI=v(),ce.insertStyleElement=L(),y()(le.A,ce),le.A&&le.A.locals&&le.A.locals;class ue extends f{constructor(e,n){super(e,"form","form-authentication"),this.router=n,this.createForm()}static validateInput(e,n){if(e.node instanceof HTMLInputElement){const t=e.node.value.trim().length>=4&&e.node.value.trim().length<=20;n.node.style.display=t?"none":"block"}}static validateForm(e,n){e.every((e=>e.node instanceof HTMLInputElement&&e.node.value.trim().length>=4&&e.node.value.trim().length<=20))?n.removeAttribute("disabled"):n.setAttribute("disabled","true")}static createNameField(e){const n=new f(e.node,"div","container-filed");new f(n.node,"label","","Name");const t=new f(n.node,"input","input");return t.setAttribute("type","text"),t.setAttribute("placeholder","Enter your name"),t.setAttribute("required","true"),t.setAttribute("minlength",4..toString()),t.setAttribute("maxlength",20..toString()),[t,new f(n.node,"span","error-message","Password must be between 4 and 20 characters")]}static createPasswordField(e){const n=new f(e.node,"div","container-filed");new f(n.node,"label","","Password");const t=new f(n.node,"input","input");return t.setAttribute("type","password"),t.setAttribute("placeholder","Enter password"),t.setAttribute("required","true"),t.setAttribute("minlength",4..toString()),t.setAttribute("maxlength",20..toString()),[t,new f(n.node,"span","error-message","Password must be between 4 and 20 characters")]}static createLoginButton(e,n,t,o,s){const a=new f(e.node,"button","log-button","Log in");a.setAttribute("disabled","true"),a.setCallback("click",(e=>{if(e.preventDefault(),n.node instanceof HTMLInputElement&&o.node instanceof HTMLInputElement){const e={id:crypto.randomUUID(),type:R.USER_LOGIN,payload:{user:{login:n.node.value,password:o.node.value}}};ae(e),t=e.id,s=e.payload.user.login,a=e.payload.user.password,t&&s&&a&&(sessionStorage.setItem("currentUserId",t),sessionStorage.setItem("currentUserLogin",s),sessionStorage.setItem("currentUserPassword",a),sessionStorage.setItem("currentUserTo"," "),sessionStorage.setItem("currentUserToStatus"," "));const i=H.filter((n=>n.login!==e.payload.user.login));for(const e of i)z(e.login)}var t,s,a}));const i=[n,o];for(const e of i)e.node.addEventListener("input",(()=>{ue.validateInput(e,e===n?t:s),ue.validateForm(i,a)}))}createInfoButton(e){const n=new f(e.node,"button","info-button",o);n.setCallback("click",(()=>this.router.navigate(u))),n.setAttribute("type","button")}createForm(){const e=new f(this.node,"fieldset","fieldset");new f(e.node,"legend","fieldset","Authentication");const[n,t]=ue.createNameField(e),[o,s]=ue.createPasswordField(e),a=new f(e.node,"div","container-buttons");ue.createLoginButton(a,n,t,o,s),this.createInfoButton(a)}}var pe=t(208),ge={};ge.styleTagTransform=T(),ge.setAttributes=A(),ge.insert=S().bind(null,"head"),ge.domAPI=v(),ge.insertStyleElement=L(),y()(pe.A,ge),pe.A&&pe.A.locals&&pe.A.locals,new class extends f{constructor(e){super(e),ee(),this.router=new W(this.node),this.router.addRoute(c,(()=>this.viewAuthenticationPage())),this.router.addRoute(p,(()=>this.viewMainPage())),this.router.addRoute(u,(()=>this.viewAboutPage())),this.router.handleRouteChange()}viewAuthenticationPage(){this.node.textContent="",new ue(this.node,this.router)}viewMainPage(){this.node.textContent="",new q(this.node,this.router)}viewAboutPage(){this.node.textContent="",new de(this.node)}}(document.body)})();